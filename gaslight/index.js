var res = [{
		file: "examples/",
		time: "2013-03-06T19:37:45.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "examples/enjoy-the-arts-example.png",
		time: "2013-03-06T19:38:45.000Z",
		size: 81568,
		type: "STANDARD"
	}, {
		file: "examples/paidsimply-example.png",
		time: "2013-03-06T19:38:45.000Z",
		size: 91451,
		type: "STANDARD"
	}, {
		file: "index.html",
		time: "2013-03-06T15:45:59.000Z",
		size: 5,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "production.dump",
		time: "2013-05-02T14:25:06.000Z",
		size: 129417452,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/",
		time: "2013-03-05T19:32:14.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "training/backbone.js",
		time: "2013-03-06T15:52:25.000Z",
		size: 55796,
		type: "STANDARD"
	}, {
		file: "training/coffee-script.js",
		time: "2013-03-06T15:52:25.000Z",
		size: 197423,
		type: "STANDARD"
	}, {
		file: "training/ect.js",
		time: "2013-03-06T15:52:25.000Z",
		size: 20282,
		type: "STANDARD"
	}, {
		file: "training/ember-data.js",
		time: "2013-04-01T00:22:06.000Z",
		size: 251683,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/ember.js",
		time: "2013-04-01T00:05:21.000Z",
		size: 770345,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/foundation.css",
		time: "2013-05-28T18:03:54.000Z",
		size: 101745,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/handlebars.js",
		time: "2013-03-07T15:13:55.000Z",
		size: 71956,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/jquery.js",
		time: "2013-04-01T00:14:28.000Z",
		size: 268381,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/slides/",
		time: "2013-04-06T05:14:53.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "training/slides/Backbone Slides.pdf",
		time: "2013-04-06T05:14:58.000Z",
		size: 3445781,
		type: "STANDARD"
	}, {
		file: "training/slides/Ember Slides.pdf",
		time: "2013-04-06T05:14:59.000Z",
		size: 1698155,
		type: "STANDARD"
	}, {
		file: "training/underscore.js",
		time: "2013-03-06T15:52:25.000Z",
		size: 41417,
		type: "STANDARD"
	}, {
		file: "training/video/",
		time: "2013-04-28T17:07:04.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "training/video/backbone/",
		time: "2013-04-28T17:07:32.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "training/video/backbone/01 Introduction.mp4",
		time: "2013-05-31T01:10:35.000Z",
		size: 41386448,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/02 Coffeescript.mp4",
		time: "2013-05-30T14:20:03.000Z",
		size: 62866754,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/03 Why Backbone?.mp4",
		time: "2013-05-31T01:10:58.000Z",
		size: 93837777,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/04 Views.mp4",
		time: "2013-05-31T01:10:58.000Z",
		size: 55088154,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/05 Example 1.mp4",
		time: "2013-05-31T01:10:58.000Z",
		size: 11491268,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/06 Lab 1.mp4",
		time: "2013-05-31T01:10:58.000Z",
		size: 4856377,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/07 View Events.mp4",
		time: "2013-05-31T01:13:20.000Z",
		size: 31187191,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/08 Example 2.mp4",
		time: "2013-05-31T01:16:04.000Z",
		size: 4843612,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/09 Lab 2.mp4",
		time: "2013-05-31T01:17:28.000Z",
		size: 2514184,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/10 Templates.mp4",
		time: "2013-05-31T01:18:20.000Z",
		size: 78775928,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/11 Example 3.mp4",
		time: "2013-05-31T01:27:28.000Z",
		size: 15799097,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/12 Lab 3.mp4",
		time: "2013-05-31T01:30:30.000Z",
		size: 4480184,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/13 Models.mp4",
		time: "2013-05-31T01:32:46.000Z",
		size: 55567263,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/14 Example 4.mp4",
		time: "2013-05-31T01:33:12.000Z",
		size: 15267111,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/15 Lab 4.mp4",
		time: "2013-05-31T01:34:38.000Z",
		size: 3682931,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/16 Lab 4 Solution.mp4",
		time: "2013-05-31T01:35:49.000Z",
		size: 14284120,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/17 Events.mp4",
		time: "2013-05-31T01:40:13.000Z",
		size: 89875230,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/18 Example 5.mp4",
		time: "2013-05-31T01:41:44.000Z",
		size: 13850237,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/19 Lab 5.mp4",
		time: "2013-05-31T01:41:54.000Z",
		size: 4981741,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/20 Collections and REST.mp4",
		time: "2013-05-31T01:43:26.000Z",
		size: 53590869,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/21 Lab 6.mp4",
		time: "2013-05-31T01:45:17.000Z",
		size: 28852123,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/22 Routers.mp4",
		time: "2013-05-31T01:50:53.000Z",
		size: 47728445,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/23 Lab 7.mp4",
		time: "2013-05-31T01:56:45.000Z",
		size: 12862671,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/24 Lab 7 Solution.mp4",
		time: "2013-05-31T01:57:05.000Z",
		size: 4390777,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/25 Lab 8.mp4",
		time: "2013-05-31T01:58:27.000Z",
		size: 6320142,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/backbone/26 Lab 8 Solution.mp4",
		time: "2013-05-31T01:58:35.000Z",
		size: 10597353,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/",
		time: "2013-05-23T12:13:20.000Z",
		size: 0,
		type: "STANDARD"
	}, {
		file: "training/video/ember/01 Introduction.mp4",
		time: "2013-05-23T12:13:25.000Z",
		size: 43322230,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/02 Why Ember?.mp4",
		time: "2013-05-23T12:13:25.000Z",
		size: 24961633,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/03 The Pieces.mp4",
		time: "2013-05-23T12:13:25.000Z",
		size: 54683643,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/04 Example 0.mp4",
		time: "2013-05-23T12:13:25.000Z",
		size: 27367340,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/05 Lab 0.mp4",
		time: "2013-05-23T12:13:25.000Z",
		size: 2850717,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/06 Bindings.mp4",
		time: "2013-05-23T12:14:23.000Z",
		size: 19182974,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/07 Example 0.mp4",
		time: "2013-05-23T12:20:53.000Z",
		size: 16312279,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/08 BindAttr and Action.mp4",
		time: "2013-05-23T12:21:33.000Z",
		size: 38345464,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/09 Example 1.mp4",
		time: "2013-05-23T12:21:52.000Z",
		size: 7227176,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/10 Lab 1.mp4",
		time: "2013-05-23T12:24:48.000Z",
		size: 9616090,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/11 Outlets and Routes.mp4",
		time: "2013-05-23T12:25:56.000Z",
		size: 95395953,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/12 Example 2.mp4",
		time: "2013-05-23T12:26:53.000Z",
		size: 8963521,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/13 Lab 2.mp4",
		time: "2013-05-23T12:29:10.000Z",
		size: 12699656,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/14 Resources.mp4",
		time: "2013-05-23T12:29:29.000Z",
		size: 56579299,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/15 Example 3.mp4",
		time: "2013-05-23T12:31:05.000Z",
		size: 26796692,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/16 Lab 3.mp4",
		time: "2013-05-23T12:31:50.000Z",
		size: 5201349,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/17 Ember Data.mp4",
		time: "2013-05-23T12:33:18.000Z",
		size: 47496298,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/18 Example 4.mp4",
		time: "2013-05-23T12:34:40.000Z",
		size: 28292483,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/19 Lab 4.mp4",
		time: "2013-05-23T12:38:15.000Z",
		size: 10289490,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/20 Custom Views.mp4",
		time: "2013-05-23T12:40:54.000Z",
		size: 29381929,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/21 Example 5.mp4",
		time: "2013-05-23T12:43:30.000Z",
		size: 34832057,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/22 Lab 5.mp4",
		time: "2013-05-23T12:46:42.000Z",
		size: 6684110,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/23 Lab 5 Solution.mp4",
		time: "2013-05-23T12:47:35.000Z",
		size: 41190121,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/24 Associations.mp4",
		time: "2013-05-23T12:49:34.000Z",
		size: 39153334,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/25 Conclusion and Questions.mp4",
		time: "2013-05-23T12:54:01.000Z",
		size: 116825699,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/video/ember/26 In Practice.mp4",
		time: "2013-05-23T12:55:07.000Z",
		size: 428881313,
		type: "REDUCED_REDUNDANCY"
	}, {
		file: "training/walrus.js",
		time: "2013-03-06T15:52:26.000Z",
		size: 40662,
		type: "STANDARD"
	}
];
var formatData = (function() {
	var root = [];
	var cache = {};
	var perRes;
	var TYPE = {
		Folder: true,
		File: false
	};
	var folder;
	var folderCache;
	var folderName;
	var filePath;
	for (var i = 0; perRes = res[i++]; cache = {}) {
		(perRes.file[perRes.file.length - 1] === "/") ? (cache.type = TYPE.Folder) : (cache.type = TYPE.File);
		filePath = perRes.file.split("/");
		for (var j = 0, folder = root; folderName = filePath[j]; j += 1) {
			if (cache.type === TYPE.File && !filePath[j + 1]) { //is file and last one
				cache.name = folderName;
				cache.href = perRes.file;
				folder[folder.length] = cache;
			} else { //nomal
				folderCache = folder[folderName];
				if (!folderCache) {
					folderCache = folder[folderName] = { //folder'name -> Array'Hash -> for quickly search
						name: folderName,
						type: TYPE.Folder,
						content: []
					};
					folder[folder.length] = folderCache;
				}
				folder = folderCache.content;

			}

		}
	}
	return root;
}())
var baseURL = "http://gaslight-cdn.s3.amazonaws.com/"
var treeviewHTML = "<ul>\n" + (function(F) {
	var cache,
		i,
		HTMLSTR = "";

	for (i = 0; cache = F[i]; i += 1) {
		if (cache.type) {
			HTMLSTR += "<li><span>" + cache.name + "</span>\n\t" + "<ul>" + arguments.callee(cache.content) + "</ul>\n" + "</li>\n\n";
		} else {
			HTMLSTR += "<li><a href='" + baseURL + cache.href + "'>" + cache.name + "</a></li>\n";
		}
	}

	return HTMLSTR
}(formatData)) + "</ul>";

// avalon.ui["treeview"] = function(elem, id, opts) {
// 	var $element = avalon(elem);
// 	var data = $element.data("json");
// 	data = JSON.parse(data);
// 	console.log(id);
// 	var uiHtml = '<ul ms-each-el="root">' +
// 		'<li ms-visible="el.type">' +
// 		'<a href="">{{el.type}}||{{el.name}}</a>' +
// 		'</li>' +
// 		'<li ms-visible="!el.type">' +
// 		'<span>{{el.name}}</span>' +
// 		'</li>' +
// 		'</ul>';

// 	avalon.define(id, function(vm) {
// 		vm.root = data;
// 		vm.openFolder = function(e) {
// 			window.vm = this;
// 			window.m = this.$model;
// 		};
// 	});
// 	elem.innerHTML = uiHtml;
// }
avalon.ready(function() {
	var showTreeViewLable = {
		"false": "显示文件树",
		"true": "显示文件表"
	};
	var gaslight = avalon.define("gaslight", function(vm) {
		var showTreeView = false;
		vm.treeviewHTML = treeviewHTML;
		vm.showTreeView = {
			get: function() {
				return showTreeView;
			},
			set: function(boolKey) {
				showTreeView = boolKey;
				this.showTreeViewLable = showTreeViewLable[this.showTreeView];
			}
		};
		vm.showTreeViewLable = showTreeViewLable[showTreeView];
		vm.toggleShowTreeView = function() {
			vm.showTreeView = !vm.showTreeView;
		}
	});

	avalon.scan();
})